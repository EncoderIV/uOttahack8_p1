log:
  stdout_log_level: INFO

!include ../shared_config.yaml

# =============================================================================
# Gemini Advisor Agent - Final reasoning layer
# Outputs water recommendation in mL (bucket capacity ~21.8 mL)
# =============================================================================

apps:
  - name: gemini-advisor_app
    app_base_path: .
    app_module: solace_agent_mesh.agent.sac.app

    broker:
      <<: *broker_connection

    app_config:
      namespace: ${NAMESPACE, sam/}
      supports_streaming: true
      agent_name: "GeminiAdvisorAgent"
      display_name: "Gemini Advisor (Water mL + Plan)"
      model: *general_model

      instruction: |
        You are the final reasoning agent for a plant monitoring system.

        You will receive JSON blocks:
        - plant_state: output from PlantStateAgent
        - weather: output from WeatherAgent (backend weather snapshot)
        - telemetry: latest telemetry (temp/humidity/pressure + optional vision)

        HARD CONSTRAINTS:
        - Bucket capacity is ~21.8 mL (2.7 cm diameter, 3.8 cm height). Never recommend more than 21.8 mL.
        - If plant_state.state is CHECK_SENSOR, do NOT recommend watering (water_ml = 0).
        - If plant_state.state is ESCALATE and vision shows form loss, prioritize user intervention and keep water conservative unless you have soil moisture (you don't).
        - You do NOT have soil moisture. You must avoid confident watering advice without it.
          Use conservative recommendations unless clear dehydration signals exist in vision and environment.

        OUTPUT JSON ONLY with this schema:
        {
          "summary": "...",
          "water_recommendation_ml": <number>,   // 0 to 21.8
          "confidence": 0.0-1.0,
          "recommended_actions": [{"action":"...", "priority":"low|medium|high", "why":"..."}],
          "reasons": ["..."],
          "questions": ["..."]
        }

        GUIDELINES FOR water_recommendation_ml:
        - If HUMIDITY_LOW and TEMP_RISK_HIGH and FORM_LOSS: water_ml should be low (0–5 mL) unless user confirms dry soil.
        - If only HUMIDITY_LOW: water_ml = 0; recommend humidity increase first.
        - If OK: water_ml = 0.
        - If user confirms soil is dry (not provided here), you may go up to 5–10 mL depending on severity.

        The orchestrator will decide whether to send the command to hardware.

      tools:
        - tool_type: builtin-group
          group_name: artifact_management

      session_service:
        type: ${PERSISTENCE_TYPE, memory}
        database_url: ${CUSTOM_AGENT_DATABASE_URL,}

      artifact_service: *default_artifact_service

      agent_card:
        description: >
          Final reasoning agent that fuses plant_state + telemetry + weather and outputs a conservative
          water recommendation in mL (0–21.8 mL) plus a short plan. No direct actuation.
        defaultInputModes: ["text"]
        defaultOutputModes: ["text", "file"]
        skills:
          - id: "water_ml"
            name: "Water mL Recommendation"
            description: "Outputs safe water_recommendation_ml + plan"

      agent_card_publishing:
        interval_seconds: 10

      agent_discovery:
        enabled: true

      inter_agent_communication:
        allow_list: ["OrchestratorAgent"]
        request_timeout_seconds: 120
